var calendarEl=document.getElementById("calendar"),calendar=new FullCalendar.Calendar(calendarEl,{expand:!0,navLinks:!0,nowIndicator:!0,selectable:!0,selectOverlap:!1,dayMaxEvents:!0,stickyHeaderDates:!0,initialView:"timeGridDay",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridDay"},slotEventOverlap:!1,slotDuration:{minutes:30},select:function(e){let t=new Date,a=new Date(e.startStr),n=new Date(e.endStr);("timeGridDay"==e.view.type||"resourceTimeGridDay"==e.view.type)&&a>t?($("#patient-id").val(sessionStorage.getItem("uid")),$("#patient-email").val(sessionStorage.getItem("email")),$("#new-appointment-modal").modal("show"),$("#new-appointment-modal input[name='start']").val(moment(a).format("YYYY-MM-DDTHH:mm")),$("#new-appointment-modal input[name='end']").val(moment(n).format("YYYY-MM-DDTHH:mm"))):$.toast({icon:"warning",text:"<p class='p-3'>Cannot Select Past Slot</p>",delay:"3000",position:"top-right",dismissible:!1})},eventSources:[{googleCalendarId:"sims2020@ahmedalnajjar.com",googleCalendarApiKey:"AIzaSyCfv18Yh96KZSjrfF0YVCpdmdmltvtPNNA",className:"gcal-event"}],eventDataTransform:function(e){return e.title="BUSY",delete e.url,delete e.description,delete e.location,e},eventClick:function(e){e.jsEvent.preventDefault()}});calendar.render(),$("#create-appointment-form").on("submit",(function(e){e.preventDefault();let t=form2js(this,".",!0,null);switch(t.start=new Date(t.start).toISOString(),t.end=new Date(t.end).toISOString(),console.log(t),t.service_type){case"Consultation Session":t.service_amount=600;break;case"Follow Up Session":t.service_amount=300;break;case"Support Session":t.service_amount=70;break;case"Associate Session":t.service_amount=400;break;case"Healthcare Report":t.service_amount=300;break;case"Package 1 | Support Session - 20":t.service_amount=3300;break;case"Package 2 | Associate Session - 12":t.service_amount=4e3}t.service_currency="AED",t.patient_id=sessionStorage.getItem("pid"),t.patient_email=sessionStorage.getItem("pt-email"),$.ajax({url:`${ENDPOINT}/users/${sessionStorage.getItem("pid")}/appointments`,method:"POST",contentType:"application/json",data:JSON.stringify(t),processData:!1}).done((function(e){if(null!=e.errorMessage)$(".error-msg").removeClass("d-none").html("Appointment Created Successfully.\nUnable to save appointment details to DB.\nTake a photo and report to Development Team.\nError: "+e.errorMessage);else if(201!=e.statusCode||e.hasOwnProperty("message"))return void $(".error-msg").removeClass("d-none").html(e.message);$(".modal").modal("hide"),$.toast({icon:"success",text:"<p class='p-3'>Appointment Registered Successful</p>",delay:"5000",position:"top-right",dismissible:!1}),$("#create-user").trigger("reset"),calendar.refetchEvents()})).fail((function(e){console.log("error - ",e),$.toast({icon:"danger",text:"<p class='p-3'>Appointment Registration Failed</p>",delay:"3000",position:"top-right",dismissible:!1})}))}));